# FREECHAT 配置说明文档

## 📋 本次修改概述


### 1. 环境变量配置 (`.env.development`, `.env.production`)

**需要用户配置：**
```bash
# 用户需要配置自己的域名
VITE_BASE_DOMAIN=你的域名.com

# 用户需要配置自己的WASM资源路径
VITE_OPENIM_WASM_URL=https://你的CDN域名/openIM.wasm
VITE_WASM_EXEC_URL='https://你的CDN域名/wasm_exec.js'
```

### 2. API自动路由配置 (`src/utils/apiAutoRoute.ts`)

**需要用户配置：**
```typescript
// 现在是空配置，需要用户自己设置
host: '默认服务器'
```

### 3. 资源URL处理 (`src/utils/common.ts`)

**需要用户配置：**
```typescript
// 现在都是空字符串，使用动态配置
baseUrl = '默认域名';
```


### 第1步：基础环境配置

#### 开发环境 (`.env.development`)
```bash
# 基础域名配置 - 替换为你的实际域名
VITE_BASE_DOMAIN=你的域名.com

# 服务地址配置（基于域名自动生成）
VITE_WS_URL=wss://$VITE_BASE_DOMAIN/msg_gateway
VITE_API_URL=https://$VITE_BASE_DOMAIN/api
VITE_CHAT_URL=https://$VITE_BASE_DOMAIN

# IP地址访问时的端口配置（本地开发用）
VITE_WS_URL1=:10003
VITE_API_URL1=:10002
VITE_CHAT_URL1=:10008
VITE_DEP_URL1=/dep

# WASM资源配置 - 替换为你的CDN地址
VITE_OPENIM_WASM_URL=https://你的CDN域名/freechat.wasm
VITE_WASM_EXEC_URL='https://你的CDN域名/wasm_exec.js'

# 应用下载配置
VITE_DOWNLOAD_LINKS_IOS=https://apps.apple.com/你的应用
VITE_DOWNLOAD_LINKS_APK=https://你的域名/app.apk
VITE_DOWNLOAD_TEXTS_IOS='下载 iOS 版本'
VITE_DOWNLOAD_TEXTS_ANDROID='下载 Android 版本'
VITE_DOWNLOAD_TEXTS_APK='下载 APK 安装包'
```


#### 生产环境 (`.env.production`)
```bash
# 生产环境配置 - 创建此文件
VITE_BASE_DOMAIN=你的正式域名.com

VITE_WS_URL=wss://$VITE_BASE_DOMAIN/msg_gateway
VITE_API_URL=https://$VITE_BASE_DOMAIN/api
VITE_CHAT_URL=https://$VITE_BASE_DOMAIN

VITE_WS_URL1=:10003
VITE_API_URL1=:10002
VITE_CHAT_URL1=:10008
VITE_DEP_URL1=/dep

# 生产环境WASM资源
VITE_OPENIM_WASM_URL=/freechat.wasm?id=4
VITE_WASM_EXEC_URL='/wasm_exec.js'

# 正式版本下载配置
VITE_DOWNLOAD_TEXTS_IOS='立即下载 iOS 版'
VITE_DOWNLOAD_TEXTS_ANDROID='立即下载 Android 版'
VITE_DOWNLOAD_TEXTS_APK='立即下载 APK'
VITE_DOWNLOAD_LINKS_IOS='https://apps.apple.com/你的正式应用'
VITE_DOWNLOAD_LINKS_APK='https://你的域名.com/app.apk'
```


### 第2步：API自动路由配置

如果你有自己的服务器节点，可以在 `src/utils/apiAutoRoute.ts` 中配置：

```typescript
private static defaultServers: ApiServerConfig[] = [
  {
    name: 'Primary Server',
    host: '你的主服务器域名',
    priority: 1,
    region: 'global',
  },
  {
    name: 'Backup Server', 
    host: '你的备用服务器域名',
    priority: 2,
    region: 'global',
  }
];
```

## 📁 目录结构说明

```
yep-im-electron/
├── .env.development     # 开发环境配置 ⚠️ 需要配置
├── .env.production     # 生产环境配置 ⚠️ 需要创建配置
├── wrangler.toml       # Cloudflare配置 ⚠️ 需要配置
├── src/
│   ├── utils/
│   │   ├── apiAutoRoute.ts   # API路由配置 🔸 可选配置
│   │   └── common.ts         # 通用工具（已自动适配）
│   └── pages/
│       └── home/index.tsx    # 首页）
└── package.json        # 项目依赖
```

## ⚙️ 环境变量详细说明

| 变量名 | 用途 | 示例值 | 必需 |
|--------|------|--------|------|
| `VITE_BASE_DOMAIN` | 基础域名 | `api.yourdomain.com` | ✅ |
| `VITE_WS_URL` | WebSocket地址 | `wss://api.yourdomain.com/msg_gateway` | ✅ |
| `VITE_API_URL` | API服务地址 | `https://api.yourdomain.com/api` | ✅ |
| `VITE_CHAT_URL` | 聊天服务地址 | `https://chat.yourdomain.com` | ✅ |
| `VITE_WS_URL1` | WebSocket端口 | `:10003` | 🔸 |
| `VITE_API_URL1` | API端口 | `:10002` | 🔸 |
| `VITE_CHAT_URL1` | 聊天端口 | `:10008` | 🔸 |
| `VITE_OPENIM_WASM_URL` | WASM文件地址 | `https://cdn.yourdomain.com/openIM.wasm` | ✅ |
| `VITE_WASM_EXEC_URL` | WASM执行器地址 | `https://cdn.yourdomain.com/wasm_exec.js` | ✅ |
| `VITE_DOWNLOAD_LINKS_IOS` | iOS下载链接 | `https://apps.apple.com/yourapp` | 🔸 |
| `VITE_DOWNLOAD_LINKS_APK` | APK下载链接 | `https://yourdomain.com/app.apk` | 🔸 |
| `VITE_DOWNLOAD_TEXTS_*` | 下载按钮文本 | `下载 iOS 版本` | 🔸 |

## 🚀 快速启动

1. **修改配置**
   - 将所有 `你的域名.com` 替换为实际域名
   - 配置 CDN 资源地址
   - 设置下载链接

2. **安装依赖**
   ```bash
   npm install 
   ```

3. **启动开发**
   ```bash
   npm run dev
   ```
